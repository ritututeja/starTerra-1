

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>starTERRA &mdash; StarTerra 0.1.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
        <script type="text/javascript" src="_static/jquery.tablesorter.min.js"></script>
        <script type="text/javascript" src="_static/cyverse.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/cyverse.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> StarTerra
          

          
          </a>

          
            
            
              <div class="version">
                0.1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <!-- Local TOC -->
              <div class="local-toc"><ul>
<li><a class="reference internal" href="#">starTERRA</a><ul>
<li><a class="reference internal" href="#what-is-starterra">What is starTERRA?</a><ul>
<li><a class="reference internal" href="#starblast-vice">starBlast-VICE</a></li>
<li><a class="reference internal" href="#starblast-dockers">starBlast-Dockers</a></li>
<li><a class="reference internal" href="#starblast-hpc">starBlast-HPC</a></li>
</ul>
</li>
<li><a class="reference internal" href="#what-is-sequenceserver">What is sequenceServer?</a></li>
<li><a class="reference internal" href="#what-is-work-queue">What is Work_Queue?</a></li>
<li><a class="reference internal" href="#platform-s">Platform(s)</a></li>
<li><a class="reference internal" href="#starblast-vice-setup">starBlast-VICE Setup</a></li>
<li><a class="reference internal" href="#starblast-docker-on-atmosphere-cloud">starBlast-Docker on Atmosphere Cloud</a><ul>
<li><a class="reference internal" href="#launching-master-worker-instances">Launching Master &amp; Worker Instances</a></li>
<li><a class="reference internal" href="#setting-up-master-docker">Setting Up Master Docker</a></li>
<li><a class="reference internal" href="#setting-up-worker-docker">Setting Up Worker Docker</a></li>
<li><a class="reference internal" href="#start-blasting">Start Blasting</a></li>
</ul>
</li>
<li><a class="reference internal" href="#starblast-hpc-setup">starBlast-HPC Setup</a><ul>
<li><a class="reference internal" href="#setting-up-the-worker-hpc">Setting Up the Worker HPC</a></li>
<li><a class="reference internal" href="#id4">Setting Up Master Docker</a></li>
</ul>
</li>
<li><a class="reference internal" href="#appendix-a">Appendix A</a><ul>
<li><a class="reference internal" href="#starblast-concept-map">starBlast concept map</a></li>
<li><a class="reference internal" href="#starblast-atmosphere-using-irods-for-custom-databases">starBlast-Atmosphere Using iRods for Custom Databases</a></li>
<li><a class="reference internal" href="#starblast-vice-using-custom-databases">starBlast-VICE Using Custom Databases</a></li>
<li><a class="reference internal" href="#starblast-docker-on-any-cloud-using-custom-databases">starBlast-Docker on any Cloud Using Custom Databases</a></li>
<li><a class="reference internal" href="#making-custom-databases-using-ncbi-blast-docker">Making Custom Databases using ncbi_blast_docker</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">StarTerra</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>starTERRA</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/intro.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="starterra">
<h1><a class="toc-backref" href="#id9">starTERRA</a><a class="headerlink" href="#starterra" title="Permalink to this headline">¶</a></h1>
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#starterra" id="id9">starTERRA</a><ul>
<li><a class="reference internal" href="#what-is-starterra" id="id10">What is starTERRA?</a><ul>
<li><a class="reference internal" href="#starblast-vice" id="id11">starBlast-VICE</a></li>
<li><a class="reference internal" href="#starblast-dockers" id="id12">starBlast-Dockers</a></li>
<li><a class="reference internal" href="#starblast-hpc" id="id13">starBlast-HPC</a></li>
</ul>
</li>
<li><a class="reference internal" href="#what-is-sequenceserver" id="id14">What is sequenceServer?</a></li>
<li><a class="reference internal" href="#what-is-work-queue" id="id15">What is Work_Queue?</a></li>
<li><a class="reference internal" href="#platform-s" id="id16">Platform(s)</a></li>
<li><a class="reference internal" href="#starblast-vice-setup" id="id17">starBlast-VICE Setup</a></li>
<li><a class="reference internal" href="#starblast-docker-on-atmosphere-cloud" id="id18">starBlast-Docker on Atmosphere Cloud</a><ul>
<li><a class="reference internal" href="#launching-master-worker-instances" id="id19">Launching Master &amp; Worker Instances</a></li>
<li><a class="reference internal" href="#setting-up-master-docker" id="id20">Setting Up Master Docker</a></li>
<li><a class="reference internal" href="#setting-up-worker-docker" id="id21">Setting Up Worker Docker</a></li>
<li><a class="reference internal" href="#start-blasting" id="id22">Start Blasting</a></li>
</ul>
</li>
<li><a class="reference internal" href="#starblast-hpc-setup" id="id23">starBlast-HPC Setup</a><ul>
<li><a class="reference internal" href="#setting-up-the-worker-hpc" id="id24">Setting Up the Worker HPC</a></li>
<li><a class="reference internal" href="#id4" id="id25">Setting Up Master Docker</a></li>
</ul>
</li>
<li><a class="reference internal" href="#appendix-a" id="id26">Appendix A</a><ul>
<li><a class="reference internal" href="#starblast-concept-map" id="id27">starBlast concept map</a></li>
<li><a class="reference internal" href="#starblast-atmosphere-using-irods-for-custom-databases" id="id28">starBlast-Atmosphere Using iRods for Custom Databases</a></li>
<li><a class="reference internal" href="#starblast-vice-using-custom-databases" id="id29">starBlast-VICE Using Custom Databases</a></li>
<li><a class="reference internal" href="#starblast-docker-on-any-cloud-using-custom-databases" id="id30">starBlast-Docker on any Cloud Using Custom Databases</a></li>
<li><a class="reference internal" href="#making-custom-databases-using-ncbi-blast-docker" id="id31">Making Custom Databases using ncbi_blast_docker</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="what-is-starterra">
<h2><a class="toc-backref" href="#id10">What is starTERRA?</a><a class="headerlink" href="#what-is-starterra" title="Permalink to this headline">¶</a></h2>
<p>starTERRA is a distributed scaling of BLAST using sequence-server and cctools.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">starBlast is a project undertaken by under-graduate and graduate students taking the “Applied Concepts in Cyberinfrastructure” course, 2019 at University of Arizona taught by Dr. Nirav Merchant and Dr. Eric Lyons.</p>
</div>
<div class="section" id="starblast-vice">
<h3><a class="toc-backref" href="#id11">starBlast-VICE</a><a class="headerlink" href="#starblast-vice" title="Permalink to this headline">¶</a></h3>
<p>starBlast-VICE is a Visual and Interactive Computing Environment in CyVerse’s Discovery Environment (DE) for running interactive apps such as sequence-server.</p>
</div>
<div class="section" id="starblast-dockers">
<h3><a class="toc-backref" href="#id12">starBlast-Dockers</a><a class="headerlink" href="#starblast-dockers" title="Permalink to this headline">¶</a></h3>
<p>starBlast-Docker containers can be deployed on any cloud such as Atmosphere for distributed scaling of BLAST searches.</p>
</div>
<div class="section" id="starblast-hpc">
<h3><a class="toc-backref" href="#id13">starBlast-HPC</a><a class="headerlink" href="#starblast-hpc" title="Permalink to this headline">¶</a></h3>
<p>starBlast-HPC is a solution to distribute large number of queries on a High Performance Computer.</p>
</div>
</div>
<div class="section" id="what-is-sequenceserver">
<h2><a class="toc-backref" href="#id14">What is sequenceServer?</a><a class="headerlink" href="#what-is-sequenceserver" title="Permalink to this headline">¶</a></h2>
<p>SequenceServer lets you rapidly set up a BLAST+ server for individual use or for sharing datasets with your colleagues and your community. Read about SequenceServer’s user-centric design and sustainable software development philosophy <a class="reference external" href="https://doi.org/10.1093/molbev/msz185">here</a>.</p>
</div>
<div class="section" id="what-is-work-queue">
<h2><a class="toc-backref" href="#id15">What is Work_Queue?</a><a class="headerlink" href="#what-is-work-queue" title="Permalink to this headline">¶</a></h2>
<p>Work Queue is a system and library for creating and managing scalable master-worker style programs that scale up to thousands of machines on clusters, clouds, and grids.</p>
</div>
<div class="section" id="platform-s">
<h2><a class="toc-backref" href="#id16">Platform(s)</a><a class="headerlink" href="#platform-s" title="Permalink to this headline">¶</a></h2>
<p><em>We will use the following CyVerse platform(s):</em></p>
<table border="1" class="docutils">
<colgroup>
<col width="17%" />
<col width="17%" />
<col width="17%" />
<col width="17%" />
<col width="17%" />
<col width="17%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Solution</th>
<th class="head">Platform</th>
<th class="head">Capacity</th>
<th class="head">Link</th>
<th class="head">Platform Documentation</th>
<th class="head">Learning Center Docs</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>starBlast VICE</td>
<td>Discovery Environment</td>
<td>5-25 Students</td>
<td><a class="reference external" href="https://de.cyverse.org/de/">Discovery Environment</a></td>
<td><a class="reference external" href="https://wiki.cyverse.org/wiki/display/DEmanual/Table+of+Contents">DE Manual</a></td>
<td><a class="reference external" href="https://learning.cyverse.org/projects/discovery-environment-guide/en/latest/">Guide</a></td>
</tr>
<tr class="row-odd"><td>starBlast Atmosphere</td>
<td>Atmosphere Cloud / Docker</td>
<td>25-50 Students</td>
<td><a class="reference external" href="https://atmo.cyverse.org/de/">Atmosphere</a></td>
<td><a class="reference external" href="https://wiki.cyverse.org/wiki/display/DEmanual/Table+of+Contents">Atmosphere Manual</a></td>
<td><a href="#id7"><span class="problematic" id="id8">`Guide &lt;&gt;`__</span></a></td>
</tr>
<tr class="row-even"><td>starBlast HPC</td>
<td>HPC &amp; Atmosphere Cloud</td>
<td>50+ Students</td>
<td><a class="reference external" href="https://atmo.cyverse.org/de/">cctools</a></td>
<td><a class="reference external" href="https://public.confluence.arizona.edu/display/UAHPC">PBS on HPC</a></td>
<td><a class="reference external" href="https://cctools.readthedocs.io/en/latest/work_queue/">Workqueue</a></td>
</tr>
</tbody>
</table>
</div>
<hr class="docutils" />
<div class="section" id="starblast-vice-setup">
<h2><a class="toc-backref" href="#id17">starBlast-VICE Setup</a><a class="headerlink" href="#starblast-vice-setup" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Requires access to Cyverse <a class="reference external" href="https://de.cyverse.org/de/">Discovery Environment</a></p>
</div>
<ol class="arabic">
<li><p class="first">Click on the following button to quick-launch sequence-server in CyVerse Discovery Environment with two blast databases (Human_GRCh38_p12 &amp; Mouse_GRCm38_p4)</p>
<blockquote>
<div><p><a class="reference external" href="https://de.cyverse.org/de/?type=quick-launch&amp;quick-launch-id=0ade6455-4876-49cc-9b37-a29129d9558a&amp;app-id=ab404686-ff20-11e9-a09c-008cfa5ae621"><img alt="sequenceServer" src="https://de.cyverse.org/Powered-By-CyVerse-blue.svg" /></a></p>
</div></blockquote>
</li>
<li><p class="first">Click [Launch Analysis]</p>
</li>
<li><p class="first">Check the notifications Bell Icon for a link to your sequenceserver instance</p>
</li>
<li><p class="first">Start BLASTING</p>
</li>
</ol>
<p>To set up a custom database on the VICE platform, see the appendix section.</p>
</div>
<hr class="docutils" />
<div class="section" id="starblast-docker-on-atmosphere-cloud">
<h2><a class="toc-backref" href="#id18">starBlast-Docker on Atmosphere Cloud</a><a class="headerlink" href="#starblast-docker-on-atmosphere-cloud" title="Permalink to this headline">¶</a></h2>
<p>To deploy starBlast setup on CyVerse Atmosphere cloud, you will need access to <a class="reference external" href="https://atmo.cyverse.org/application/images">Atmosphere</a>. Request access to Atmosphere from your <a class="reference external" href="https://user.cyverse.org">CyVerse user account</a>.</p>
<p>You will need to launch a Master instance that will host sequenceServer and one or more Worker instances as needed to distribute the blast jobs.</p>
<p>Both the Master and Worker Virtual Machine instances use Docker containers to run sequenceServer and connect Workers.</p>
<div class="section" id="launching-master-worker-instances">
<h3><a class="toc-backref" href="#id19">Launching Master &amp; Worker Instances</a><a class="headerlink" href="#launching-master-worker-instances" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>Go to <a class="reference external" href="https://atmo.cyverse.org">https://atmo.cyverse.org</a> and log in with your Cyverse Username and Password</li>
<li>Launch a Master (medium1) instance which will broadcast as a Master using <a class="reference external" href="https://atmo.cyverse.org/application/images/1759">this</a> image with docker preinstalled.</li>
<li>Launch a Worker (XLarge1) instance which will connect to the Master using <a class="reference external" href="https://atmo.cyverse.org/application/images/1759">this</a> image with docker preinstalled.</li>
<li>When the instances are ready showing Active (with a green dot), login to your Master and Worker instances using ssh &lt;CYVERSE_USERNAME&gt;&#64;&lt;MASTER_VM_IP_ADDRESS&gt; and enter your cyverse password.</li>
</ol>
</div>
<div class="section" id="setting-up-master-docker">
<h3><a class="toc-backref" href="#id20">Setting Up Master Docker</a><a class="headerlink" href="#setting-up-master-docker" title="Permalink to this headline">¶</a></h3>
<p>Copy and pase the following code in the Master instance to launch sequenceServer with two databases (Human_GRCh38_p12 &amp; Mouse_GRCm38_p4) ready to distribute BLAST queries to workers</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">ti</span> <span class="o">-</span><span class="n">p</span> <span class="mi">80</span><span class="p">:</span><span class="mi">3000</span> <span class="o">-</span><span class="n">p</span> <span class="mi">9123</span><span class="p">:</span><span class="mi">9123</span> <span class="o">-</span><span class="n">e</span> <span class="n">PROJECT_NAME</span><span class="o">=</span><span class="n">starBlast</span> <span class="o">-</span><span class="n">e</span> <span class="n">WORKQUEUE_PASSWORD</span><span class="o">=</span> <span class="o">-</span><span class="n">e</span> <span class="n">BLAST_NUM_THREADS</span><span class="o">=</span><span class="mi">4</span> <span class="n">zhxu73</span><span class="o">/</span><span class="n">sequenceserver</span><span class="o">-</span><span class="n">scale</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">It might take 2-5min to download the databases from CyVerse data store</p>
</div>
</div>
<div class="section" id="setting-up-worker-docker">
<h3><a class="toc-backref" href="#id21">Setting Up Worker Docker</a><a class="headerlink" href="#setting-up-worker-docker" title="Permalink to this headline">¶</a></h3>
<p>Copy and paste the following code into your Worker instance to connect the Worker docker to the Master docker. The Worker knows where to find the master by the environmental variable PROJECT_NAME set as above.</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">ti</span> <span class="o">--</span><span class="n">net</span><span class="o">=</span><span class="n">host</span> <span class="o">-</span><span class="n">e</span> <span class="n">PROJECT_NAME</span><span class="o">=</span><span class="n">starBlast</span> <span class="o">-</span><span class="n">e</span> <span class="n">WORKQUEUE_PASSWORD</span><span class="o">=</span> <span class="o">-</span><span class="n">e</span> <span class="n">BLAST_NUM_THREADS</span><span class="o">=</span><span class="mi">4</span> <span class="o">-</span><span class="n">e</span> <span class="n">NUM_WORKER</span><span class="o">=</span><span class="mi">2</span> <span class="n">zhxu73</span><span class="o">/</span><span class="n">sequenceserver</span><span class="o">-</span><span class="n">scale</span><span class="o">-</span><span class="n">worker</span>
</pre></div>
</div>
</div>
<div class="section" id="start-blasting">
<h3><a class="toc-backref" href="#id22">Start Blasting</a><a class="headerlink" href="#start-blasting" title="Permalink to this headline">¶</a></h3>
<p>Now, anyone can open a web-browser and go to &lt;MASTER_VM_IP_ADDRESS&gt; to access sequence-Server front-end and start BLASTING!</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">MASTER_VM_IP_ADDRESS</span><span class="o">&gt;</span>
</pre></div>
</div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="starblast-hpc-setup">
<h2><a class="toc-backref" href="#id23">starBlast-HPC Setup</a><a class="headerlink" href="#starblast-hpc-setup" title="Permalink to this headline">¶</a></h2>
<p>The starBlast-HPC Setup  was conceived for groups that wish a larger quantity of power.</p>
<p>In order to achieve a successful setup of the starBlast HPC system, a small amount of command line knowledge is required.</p>
<p>Similar to the starBlast-Atmosphere Cloud,  the starBlast HPC system has a Master-Worker set up: a dockerized atmosphere VM machine acts as the Master, and the HPC acts as the Worker. It is suggested that the Worker is set up well ahead of time.</p>
<div class="section" id="setting-up-the-worker-hpc">
<h3><a class="toc-backref" href="#id24">Setting Up the Worker HPC</a><a class="headerlink" href="#setting-up-the-worker-hpc" title="Permalink to this headline">¶</a></h3>
<p>It is important that the following software are installed on the HPC:</p>
<ul class="simple">
<li>glibc version 2.14 or newer,</li>
<li>ncbi-blast+ version 2.6.0 or newer (<a class="reference external" href="ftp://ftp.ncbi.nlm.nih.gov/blast/executables/blast+/LATEST/ncbi-blast-2.9.0+-src.tar.gz">ftp://ftp.ncbi.nlm.nih.gov/blast/executables/blast+/LATEST/ncbi-blast-2.9.0+-src.tar.gz</a>)</li>
<li>CCTools (cctools-7.0.21-x86_64-centos7.tar.gz)</li>
</ul>
<p>Put both ncbi-blast+ and CCTools in your home directory.
Databases need to be downloaded in a personal directory in the home folder.</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">home</span><span class="o">/&lt;</span><span class="n">U_NUMBER</span><span class="o">&gt;/&lt;</span><span class="n">USER</span><span class="o">&gt;/</span><span class="n">Database</span>
</pre></div>
</div>
<p>The HPC uses a .pbs and qsub system to submit jobs.</p>
<p>Create a .pbs file that contains the following code and change the &lt;VARIABLES&gt; to preferred options:</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span>#!/bin/bash
#PBS -W group_list=&lt;GROUP_NAME&gt;
#PBS -q &lt;QUEUE_TYPE&gt;
#PBS -l select=&lt;NUMBER_OF_NODES&gt;:ncpus=&lt;NUMBER_OF_CPUS_PER_NODE&gt;:mem=&lt;NUMBER_OF_RAM_PER_NODE&gt;gb
#PBS -l place=pack:shared
#PBS -l walltime=&lt;WALLTIME_REQUIRED&gt;
#PBS -l cput=&lt;WALLTIME_REQUIRED&gt;
module load unsupported
module load ferng/glibc
export CCTOOLS_HOME=/home/&lt;U_NUMBER&gt;/&lt;USER&gt;/cctools-7.0.19-x86_64-centos7
export PATH=${CCTOOLS_HOME}/bin:$PATH
export PATH=$PATH:/home/&lt;U_NUMBER&gt;/&lt;USER&gt;/ncbi-blast-2.9.0+/bin
/home/&lt;U_NUMBER&gt;/&lt;USER&gt;/cctools-7.0.19-x86_64-centos7/bin/work_queue_factory -M starBLAST -T local -w &lt;NUMBER_OF_WORKERS&gt;
</pre></div>
</div>
<p>An example of a .pbs file running on the University of Arizona HPC:</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span>#!/bin/bash
#PBS -W group_list=ericlyons
#PBS -q windfall
#PBS -l select=2:ncpus=6:mem=24gb
#PBS -l place=pack:shared
#PBS -l walltime=02:00:00
#PBS -l cput=02:00:00
module load unsupported
module load ferng/glibc
module load blast
export CCTOOLS_HOME=/home/u12/cosi/cctools-7.0.19-x86_64-centos7
export PATH=${CCTOOLS_HOME}/bin:$PATH
cd /home/u12/cosi/cosi-workers
/home/u12/cosi/cctools-7.0.19-x86_64-centos7/bin/work_queue_factory -M starBLAST -T local -w 2
</pre></div>
</div>
<p>In the example above, the user already has blast installed (calls it using “module load blast“). The script will submit to the HPC nodes a total of 2 workers.</p>
<p>Submit the .pbs script with</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">qsub</span> <span class="o">&lt;</span><span class="n">NAME_OF_PBS</span><span class="o">&gt;.</span><span class="n">pbs</span>
</pre></div>
</div>
</div>
<div class="section" id="id4">
<h3><a class="toc-backref" href="#id25">Setting Up Master Docker</a><a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<p>Copy and paste the following code in the Master instance to launch sequenceServer with two databases (Human_GRCh38_p12 &amp; Mouse_GRCm38_p4) ready to distribute BLAST queries to workers</p>
<p>IMPORTANT: THE PATH TO THE DATABASE ON THE MASTER NEED TO BE THE SAME AS THE ONE ON THE WORKER</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">run</span> <span class="o">--</span><span class="n">rm</span> <span class="o">-</span><span class="n">ti</span> <span class="o">-</span><span class="n">p</span> <span class="mi">80</span><span class="p">:</span><span class="mi">3000</span> <span class="o">-</span><span class="n">p</span> <span class="mi">9123</span><span class="p">:</span><span class="mi">9123</span> <span class="o">-</span><span class="n">e</span> <span class="n">PROJECT_NAME</span><span class="o">=</span><span class="n">starBLAST</span> <span class="o">=</span> <span class="o">-</span><span class="n">e</span> <span class="n">BLAST_NUM_THREADS</span><span class="o">=</span><span class="mi">4</span> <span class="o">-</span><span class="n">e</span> <span class="n">SEQSERVER_DB_PATH</span><span class="o">=/</span><span class="n">home</span><span class="o">/&lt;</span><span class="n">U_NUMBER</span><span class="o">&gt;/&lt;</span><span class="n">USER</span><span class="o">&gt;/</span><span class="n">Database</span> <span class="n">zhxu73</span><span class="o">/</span><span class="n">sequenceserver</span><span class="o">-</span><span class="n">scale</span>
</pre></div>
</div>
<p>An example is:</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">run</span> <span class="o">--</span><span class="n">rm</span> <span class="o">-</span><span class="n">ti</span> <span class="o">-</span><span class="n">p</span> <span class="mi">80</span><span class="p">:</span><span class="mi">3000</span> <span class="o">-</span><span class="n">p</span> <span class="mi">9123</span><span class="p">:</span><span class="mi">9123</span> <span class="o">-</span><span class="n">e</span> <span class="n">PROJECT_NAME</span><span class="o">=</span><span class="n">starBLAST</span> <span class="o">=</span> <span class="o">-</span><span class="n">e</span> <span class="n">BLAST_NUM_THREADS</span><span class="o">=</span><span class="mi">4</span> <span class="o">-</span><span class="n">e</span> <span class="n">SEQSERVER_DB_PATH</span><span class="o">=/</span><span class="n">home</span><span class="o">/</span><span class="n">u12</span><span class="o">/</span><span class="n">cosi</span><span class="o">/</span><span class="n">Data</span> <span class="n">zhxu73</span><span class="o">/</span><span class="n">sequenceserver</span><span class="o">-</span><span class="n">scale</span>
</pre></div>
</div>
<p>In case the user does not have access to iRODS please use:</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span>docker run --rm -ti -p 80:3000 -p 9123:9123 -e PROJECT_NAME=starBLAST -e WORKQUEUE_PASSWORD= -e BLAST_NUM_THREADS=4 -e /home/&lt;U_NUMBER&gt;/&lt;USER&gt;/Database -v $HOME/blastdb:/&lt;U_NUMBER&gt;/&lt;USER&gt;/Database zhxu73/sequenceserver-scale:no-irods
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The custom Database folder on the Master needs to have read and write permissions</p>
</div>
<p>Start BLASTING! Enter the &lt;MASTER_VM_IP_ADDRESS&gt; in your browser using the actual Master IP address.</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">MASTER_VM_IP_ADDRESS</span><span class="o">&gt;</span>
</pre></div>
</div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="appendix-a">
<h2><a class="toc-backref" href="#id26">Appendix A</a><a class="headerlink" href="#appendix-a" title="Permalink to this headline">¶</a></h2>
<div class="section" id="starblast-concept-map">
<h3><a class="toc-backref" href="#id27">starBlast concept map</a><a class="headerlink" href="#starblast-concept-map" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="http://learning.cyverse.org/"><img alt="concept_map" src="./img/concept_map.png" style="width: 500px; height: 500px;" /></a></p>
</div>
<div class="section" id="starblast-atmosphere-using-irods-for-custom-databases">
<h3><a class="toc-backref" href="#id28">starBlast-Atmosphere Using iRods for Custom Databases</a><a class="headerlink" href="#starblast-atmosphere-using-irods-for-custom-databases" title="Permalink to this headline">¶</a></h3>
<p>Set the PATH to custom databases on CyVerse Data Store by using the custom IRODS_SYNC_PATH variable</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">e</span> <span class="n">IRODS_SYNC_PATH</span><span class="o">=/</span><span class="n">PATH</span><span class="o">/</span><span class="n">TO</span><span class="o">/</span><span class="n">Databases</span>
</pre></div>
</div>
</div>
<div class="section" id="starblast-vice-using-custom-databases">
<h3><a class="toc-backref" href="#id29">starBlast-VICE Using Custom Databases</a><a class="headerlink" href="#starblast-vice-using-custom-databases" title="Permalink to this headline">¶</a></h3>
<p>See documentation and a demo tutorial on launching the sequenceserver VICE app with custom databases <a class="reference external" href="https://cyverse-sequenceserver.readthedocs-hosted.com/en/latest/">here</a>.</p>
</div>
<div class="section" id="starblast-docker-on-any-cloud-using-custom-databases">
<h3><a class="toc-backref" href="#id30">starBlast-Docker on any Cloud Using Custom Databases</a><a class="headerlink" href="#starblast-docker-on-any-cloud-using-custom-databases" title="Permalink to this headline">¶</a></h3>
<p>starBlast (no-irods) docker containers can be run on any cloud platform/s you have access to by supplying the local path to blast databases as follows:</p>
<p>Master/Web Docker</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">ti</span> <span class="o">-</span><span class="n">p</span> <span class="mi">80</span><span class="p">:</span><span class="mi">3000</span> <span class="o">-</span><span class="n">p</span> <span class="mi">9123</span><span class="p">:</span><span class="mi">9123</span> <span class="o">-</span><span class="n">e</span> <span class="n">PROJECT_NAME</span><span class="o">=</span><span class="n">starBlast</span> <span class="o">-</span><span class="n">e</span> <span class="n">WORKQUEUE_PASSWORD</span><span class="o">=</span> <span class="o">-</span><span class="n">e</span> <span class="n">BLAST_NUM_THREADS</span><span class="o">=</span><span class="mi">4</span> <span class="o">--</span><span class="n">volume</span><span class="o">=/</span><span class="n">local_db_path</span><span class="p">:</span><span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">sequenceserver</span><span class="o">/</span><span class="n">db</span> <span class="n">zhxu73</span><span class="o">/</span><span class="n">sequenceserver</span><span class="o">-</span><span class="n">scale</span><span class="p">:</span><span class="n">no</span><span class="o">-</span><span class="n">irods</span>
</pre></div>
</div>
<p>Worker Docker</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">ti</span> <span class="o">--</span><span class="n">net</span><span class="o">=</span><span class="n">host</span> <span class="o">-</span><span class="n">e</span> <span class="n">PROJECT_NAME</span><span class="o">=</span><span class="n">starBlast</span> <span class="o">-</span><span class="n">e</span> <span class="n">WORKQUEUE_PASSWORD</span><span class="o">=</span> <span class="o">-</span><span class="n">e</span> <span class="n">BLAST_NUM_THREADS</span><span class="o">=</span><span class="mi">4</span> <span class="o">-</span><span class="n">e</span> <span class="n">NUM_WORKER</span><span class="o">=</span><span class="mi">2</span> <span class="o">--</span><span class="n">volume</span><span class="o">=/</span><span class="n">local_db_path</span><span class="p">:</span><span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">sequenceserver</span><span class="o">/</span><span class="n">db</span> <span class="n">zhxu73</span><span class="o">/</span><span class="n">sequenceserver</span><span class="o">-</span><span class="n">scale</span><span class="o">-</span><span class="n">worker</span><span class="p">:</span><span class="n">no</span><span class="o">-</span><span class="n">irods</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Here are some links to private and public cloud service providers:</p>
<p><a class="reference external" href="https://use.jetstream-cloud.org/application/images">XSEDE Jetstream</a></p>
<p><a class="reference external" href="https://www.digitalocean.com/">Digital Ocean Cloud</a>. See more documentation <a class="reference external" href="https://github.com/sateeshperi/starBlast/blob/master/DO.rst">here</a>.</p>
<p class="last"><a class="reference external" href="https://cloud.google.com/">Google Cloud Platform</a></p>
</div>
</div>
<div class="section" id="making-custom-databases-using-ncbi-blast-docker">
<h3><a class="toc-backref" href="#id31">Making Custom Databases using ncbi_blast_docker</a><a class="headerlink" href="#making-custom-databases-using-ncbi-blast-docker" title="Permalink to this headline">¶</a></h3>
<p>Read more here at <a class="reference external" href="https://github.com/ncbi/docker/wiki/Getting-BLAST-databases">ncbi docker wiki</a></p>
<hr class="docutils" />
<p><strong>Fix or improve this documentation</strong></p>
<ul class="simple">
<li>On Github: <a class="reference external" href="https://github.com/sateeshperi/starBlast/">Repo link</a></li>
<li>Send feedback: <a class="reference external" href="mailto:Tutorials&#37;&#52;&#48;CyVerse&#46;org">Tutorials<span>&#64;</span>CyVerse<span>&#46;</span>org</a></li>
</ul>
<hr class="docutils" />
<p><a class="reference external" href="http://learning.cyverse.org/"><img alt="Home_Icon" src="./img/homeicon.png" style="width: 25px; height: 25px;" /></a>
<a href="#id32"><span class="problematic" id="id33">`Learning Center Home`_</span></a></p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, CyVerse

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>